name: suggestion-optuna
version: v1beta1
base: ubuntu:22.04
summary: Optuna Rock
description: |
  Optuna Service
license: Apache-2.0
platforms:
    amd64:

services:
  optuna:
  override: replace
    command: /bin/python3 /opt/katib/cmd/suggestion/optuna/v1beta1/main.py
  environment:
      PYTHONPATH: "/opt/katib:/opt/katib/pkg/apis/manager/v1beta1/python:/opt/katib/pkg/apis/manager/health/python"

parts:
  grpc-health-probe:
    plugin: dump
      source: https://github.com/grpc-ecosystem/grpc-health-probe/releases/download/v0.4.15/grpc_health_probe-linux-amd64
      source-type: file
      organize:
        grpc_health_probe-linux-amd64: bin/grpc_health_probe
      override-stage: |
        craftctl default
        chmod +x $CRAFT_STAGE/bin/grpc_health_probe

  pkg:
      plugin: dump
      source: https://github.com/kubeflow/katib.git
      source-depth: 1
      source-type: git
      source-subdir: pkg 
      organize:
        '*': opt/katib/pkg/

  optuna:
      plugin: dump
      source: https://github.com/kubeflow/katib.git
      source-depth: 1
      source-type: git
      source-subdir: cmd/suggestion/optuna/v1beta1
      organize:
        main.py: opt/katib/cmd/suggestion/optuna/v1beta1/main.py
        requirements.txt: opt/katib/cmd/suggestion/optuna/v1beta1/requirements.txt
      stage:
        - opt/katib/cmd/suggestion/optuna/v1beta1/main.py
        - opt/katib/cmd/suggestion/optuna/v1beta1/requirements.txt

  optuna-dependencies:
    plugin: python
      source: https://github.com/kubeflow/katib.git
      source-depth: 1
      source-type: git
      source-subdir: cmd/suggestion/optuna/v1beta1
      python-requirements:
        - requirements.txt
      stage-packages:
        - python3-venv
